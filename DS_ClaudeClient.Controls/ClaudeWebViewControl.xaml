<UserControl x:Class="DS_ClaudeClient.Controls.ClaudeWebViewControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/DS_ClaudeClient.Controls;component/Themes/Generic.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition x:Name="TextAreaRow" Height="100" MinHeight="60" MaxHeight="400"/>
        </Grid.RowDefinitions>

        <!-- WebView2 for Claude.ai -->
        <wv2:WebView2 x:Name="ClaudeWebView"
                      Grid.Row="0"/>

        <!-- Resizable Splitter -->
        <GridSplitter x:Name="TextAreaSplitter"
                      Grid.Row="1"
                      Height="3"
                      HorizontalAlignment="Stretch"
                      Style="{StaticResource ControlGridSplitterStyle}"
                      Cursor="SizeNS"/>

        <!-- Native Text Input Area -->
        <Border x:Name="TextAreaBorder"
                Grid.Row="2"
                Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Text Input -->
                <TextBox x:Name="MessageInput"
                         Grid.Column="0"
                         AcceptsReturn="True"
                         AcceptsTab="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                         Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"
                         BorderThickness="0"
                         Padding="12,10"
                         CaretBrush="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"
                         KeyDown="MessageInput_KeyDown"/>

                <!-- Right Side Buttons -->
                <StackPanel Grid.Column="1"
                            Orientation="Vertical"
                            VerticalAlignment="Top"
                            Margin="4">

                    <!-- Collapse/Expand Button -->
                    <Button x:Name="CollapseButton"
                            Style="{StaticResource IconButtonStyle}"
                            Click="CollapseTextArea_Click"
                            ToolTip="Collapse text area">
                        <TextBlock Text="â–¼" FontSize="10"/>
                    </Button>

                    <!-- Clear Button -->
                    <Button Style="{StaticResource IconButtonStyle}"
                            Click="ClearButton_Click"
                            ToolTip="Clear text">
                        <TextBlock Text="âœ•" FontSize="12"/>
                    </Button>

                    <!-- Copy Button -->
                    <Button Style="{StaticResource IconButtonStyle}"
                            Click="CopyButton_Click"
                            ToolTip="Copy to clipboard">
                        <TextBlock Text="ðŸ“‹" FontSize="12"/>
                    </Button>

                    <!-- Send to Claude Button -->
                    <Button x:Name="SendButton"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Click="SendButton_Click"
                            Padding="8,6"
                            Margin="0,8,0,0"
                            ToolTip="Send message (Shift+Enter)">
                        <TextBlock Text="Send" FontSize="11"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Collapsed Text Area Bar (hidden by default) -->
        <Border x:Name="CollapsedTextAreaBar"
                Grid.Row="2"
                Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                BorderThickness="0,1,0,0"
                Height="32"
                Visibility="Collapsed"
                Cursor="Hand"
                MouseLeftButtonDown="CollapsedTextAreaBar_Click">
            <Grid>
                <TextBlock Text="Click to expand text area"
                           Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           FontSize="12"/>
                <Button Style="{StaticResource IconButtonStyle}"
                        Click="ExpandTextArea_Click"
                        HorizontalAlignment="Right"
                        Margin="0,0,8,0"
                        ToolTip="Expand text area">
                    <TextBlock Text="â–²" FontSize="10"/>
                </Button>
            </Grid>
        </Border>
    </Grid>
</UserControl>
