<Window x:Class="DS_ClaudeClient.HistoryDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Message History"
        Height="500" Width="600"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResize">

    <Border Background="{StaticResource SurfaceBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="36"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8,8,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <TextBlock Text="Message History"
                               Foreground="{StaticResource TextBrush}"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               FontSize="14"/>
                    <Button Style="{StaticResource IconButtonStyle}"
                            Click="CloseButton_Click"
                            HorizontalAlignment="Right"
                            Margin="0,0,8,0"
                            ToolTip="Close">
                        <TextBlock Text="&#x2715;" FontSize="14"/>
                    </Button>
                </Grid>
            </Border>

            <!-- History List -->
            <ListBox x:Name="HistoryList"
                     Grid.Row="1"
                     Background="Transparent"
                     BorderThickness="0"
                     Margin="12"
                     SelectionChanged="HistoryList_SelectionChanged">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{StaticResource BackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="10,8"
                                Margin="0,0,0,6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding Preview}"
                                           Foreground="{StaticResource TextBrush}"
                                           TextWrapping="Wrap"
                                           MaxHeight="60"
                                           VerticalAlignment="Center"/>
                                <Button Grid.Column="1"
                                        Style="{StaticResource IconButtonStyle}"
                                        Click="CopyButton_Click"
                                        Tag="{Binding}"
                                        ToolTip="Copy to clipboard"
                                        VerticalAlignment="Center"
                                        Margin="8,0,0,0">
                                    <TextBlock Text="&#x1F4CB;" FontSize="14"/>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <ContentPresenter/>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>

            <!-- Selected Message Preview -->
            <Border Grid.Row="2"
                    Background="{StaticResource BackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="12">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Selected Message:"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="12"
                               Margin="0,0,0,6"/>
                    <TextBox x:Name="SelectedMessageText"
                             Grid.Row="1"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"
                             MaxHeight="120"
                             Background="{StaticResource InputBackgroundBrush}"
                             Foreground="{StaticResource TextBrush}"
                             BorderBrush="{StaticResource BorderBrush}"
                             BorderThickness="1"
                             Padding="8,6"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
